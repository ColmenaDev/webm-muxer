"use strict";var WebMMuxer=(()=>{var St=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames,oe=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var b=Math.pow,le=(h,e,i)=>e in h?St(h,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[e]=i,ue=(h,e)=>{for(var i in e||={})de.call(e,i)&&le(h,i,e[i]);if(oe)for(var i of oe(e))Ne.call(e,i)&&le(h,i,e[i]);return h};var Oe=(h,e)=>{for(var i in e)St(h,i,{get:e[i],enumerable:!0})},He=(h,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ve(e))!de.call(h,r)&&r!==i&&St(h,r,{get:()=>e[r],enumerable:!(s=Me(e,r))||s.enumerable});return h};var We=h=>He(St({},"__esModule",{value:!0}),h);var jt=(h,e,i)=>{if(!e.has(h))throw TypeError("Cannot "+i)};var t=(h,e,i)=>(jt(h,e,"read from private field"),i?i.call(h):e.get(h)),a=(h,e,i)=>{if(e.has(h))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(h):e.set(h,i)},f=(h,e,i,s)=>(jt(h,e,"write to private field"),s?s.call(h,i):e.set(h,i),i);var o=(h,e,i)=>(jt(h,e,"access private method"),i);var Xe={};Oe(Xe,{ArrayBufferTarget:()=>st,FileSystemWritableFileStreamTarget:()=>rt,Muxer:()=>Nt,StreamTarget:()=>E});var B=class{constructor(e){this.value=e}},D=class{constructor(e){this.value=e}};var Lt=h=>h<1<<8?1:h<1<<16?2:h<1<<24?3:h<b(2,32)?4:h<b(2,40)?5:6,fe=h=>{if(h<(1<<7)-1)return 1;if(h<(1<<14)-1)return 2;if(h<(1<<21)-1)return 3;if(h<(1<<28)-1)return 4;if(h<b(2,35)-1)return 5;if(h<b(2,42)-1)return 6;throw new Error("EBML VINT size not supported "+h)};var P=(h,e,i)=>{let s=0;for(let r=e;r<i;r++){let n=Math.floor(r/8),d=h[n],c=7-(r&7),it=(d&1<<c)>>c;s<<=1,s|=it}return s},me=(h,e,i,s)=>{for(let r=e;r<i;r++){let n=Math.floor(r/8),d=h[n],c=7-(r&7);d&=~(1<<c),d|=(s&1<<i-r-1)>>i-r-1<<c,h[n]=d}};var st=class{constructor(){this.buffer=null}},E=class{constructor(e,i,s){this.onData=e;this.onDone=i;this.options=s}},rt=class{constructor(e,i){this.stream=e;this.options=i}};var x,m,Vt,ce,Dt,be,Pt,pe,ot,Jt,Et,ge,at=class{constructor(){a(this,Vt);a(this,Dt);a(this,Pt);a(this,ot);a(this,Et);this.pos=0;a(this,x,new Uint8Array(8));a(this,m,new DataView(t(this,x).buffer));this.offsets=new WeakMap;this.dataOffsets=new WeakMap}seek(e){this.pos=e}writeEBMLVarInt(e,i=fe(e)){let s=0;switch(i){case 1:t(this,m).setUint8(s++,1<<7|e);break;case 2:t(this,m).setUint8(s++,1<<6|e>>8),t(this,m).setUint8(s++,e);break;case 3:t(this,m).setUint8(s++,1<<5|e>>16),t(this,m).setUint8(s++,e>>8),t(this,m).setUint8(s++,e);break;case 4:t(this,m).setUint8(s++,1<<4|e>>24),t(this,m).setUint8(s++,e>>16),t(this,m).setUint8(s++,e>>8),t(this,m).setUint8(s++,e);break;case 5:t(this,m).setUint8(s++,1<<3|e/b(2,32)&7),t(this,m).setUint8(s++,e>>24),t(this,m).setUint8(s++,e>>16),t(this,m).setUint8(s++,e>>8),t(this,m).setUint8(s++,e);break;case 6:t(this,m).setUint8(s++,1<<2|e/b(2,40)&3),t(this,m).setUint8(s++,e/b(2,32)|0),t(this,m).setUint8(s++,e>>24),t(this,m).setUint8(s++,e>>16),t(this,m).setUint8(s++,e>>8),t(this,m).setUint8(s++,e);break;default:throw new Error("Bad EBML VINT size "+i)}this.write(t(this,x).subarray(0,s))}writeEBML(e){var i,s;if(e!==null)if(e instanceof Uint8Array)this.write(e);else if(Array.isArray(e))for(let r of e)this.writeEBML(r);else if(this.offsets.set(e,this.pos),o(this,ot,Jt).call(this,e.id),Array.isArray(e.data)){let r=this.pos,n=e.size===-1?1:(i=e.size)!=null?i:4;e.size===-1?o(this,Vt,ce).call(this,255):this.seek(this.pos+n);let d=this.pos;if(this.dataOffsets.set(e,d),this.writeEBML(e.data),e.size!==-1){let c=this.pos-d,it=this.pos;this.seek(r),this.writeEBMLVarInt(c,n),this.seek(it)}}else if(typeof e.data=="number"){let r=(s=e.size)!=null?s:Lt(e.data);this.writeEBMLVarInt(r),o(this,ot,Jt).call(this,e.data,r)}else typeof e.data=="string"?(this.writeEBMLVarInt(e.data.length),o(this,Et,ge).call(this,e.data)):e.data instanceof Uint8Array?(this.writeEBMLVarInt(e.data.byteLength,e.size),this.write(e.data)):e.data instanceof B?(this.writeEBMLVarInt(4),o(this,Dt,be).call(this,e.data.value)):e.data instanceof D&&(this.writeEBMLVarInt(8),o(this,Pt,pe).call(this,e.data.value))}};x=new WeakMap,m=new WeakMap,Vt=new WeakSet,ce=function(e){t(this,m).setUint8(0,e),this.write(t(this,x).subarray(0,1))},Dt=new WeakSet,be=function(e){t(this,m).setFloat32(0,e,!1),this.write(t(this,x).subarray(0,4))},Pt=new WeakSet,pe=function(e){t(this,m).setFloat64(0,e,!1),this.write(t(this,x))},ot=new WeakSet,Jt=function(e,i=Lt(e)){let s=0;switch(i){case 6:t(this,m).setUint8(s++,e/b(2,40)|0);case 5:t(this,m).setUint8(s++,e/b(2,32)|0);case 4:t(this,m).setUint8(s++,e>>24);case 3:t(this,m).setUint8(s++,e>>16);case 2:t(this,m).setUint8(s++,e>>8);case 1:t(this,m).setUint8(s++,e);break;default:throw new Error("Bad UINT size "+i)}this.write(t(this,x).subarray(0,s))},Et=new WeakSet,ge=function(e){this.write(new Uint8Array(e.split("").map(i=>i.charCodeAt(0))))};var lt,A,K,dt,It,Ut=class extends at{constructor(i){super();a(this,dt);a(this,lt,void 0);a(this,A,new ArrayBuffer(b(2,16)));a(this,K,new Uint8Array(t(this,A)));f(this,lt,i)}write(i){o(this,dt,It).call(this,this.pos+i.byteLength),t(this,K).set(i,this.pos),this.pos+=i.byteLength}finalize(){o(this,dt,It).call(this,this.pos),t(this,lt).buffer=t(this,A).slice(0,this.pos)}};lt=new WeakMap,A=new WeakMap,K=new WeakMap,dt=new WeakSet,It=function(i){let s=t(this,A).byteLength;for(;s<i;)s*=2;if(s===t(this,A).byteLength)return;let r=new ArrayBuffer(s),n=new Uint8Array(r);n.set(t(this,K),0),f(this,A,r),f(this,K,n)};var $,U,ut,ft,nt=class extends at{constructor(i,s){super();a(this,$,void 0);a(this,U,[]);a(this,ut,0);a(this,ft,void 0);f(this,$,i),f(this,ft,s)}write(i){t(this,U).push({data:i.slice(),start:this.pos}),this.pos+=i.byteLength}flush(){if(t(this,U).length===0)return;let i=[],s=[...t(this,U)].sort((r,n)=>r.start-n.start);i.push({start:s[0].start,size:s[0].data.byteLength});for(let r=1;r<s.length;r++){let n=i[i.length-1],d=s[r];d.start<=n.start+n.size?n.size=Math.max(n.size,d.start+d.data.byteLength-n.start):i.push({start:d.start,size:d.data.byteLength})}for(let r of i){r.data=new Uint8Array(r.size);for(let n of t(this,U))r.start<=n.start&&n.start<r.start+r.size&&r.data.set(n.data,n.start-r.start);if(t(this,ft)&&r.start<t(this,ut))throw new Error("Internal error: Monotonicity violation.");t(this,$).onData(r.data,r.start),f(this,ut,r.start+r.data.byteLength)}t(this,U).length=0}finalize(){var i,s;(s=(i=t(this,$)).onDone)==null||s.call(i)}};$=new WeakMap,U=new WeakMap,ut=new WeakMap,ft=new WeakMap;var Be=b(2,24),Ke=2,Y,g,p,mt,ct,bt,te,Ft,we,Rt,ye,Z,At,ht=class extends at{constructor(i,s){var r,n;super();a(this,bt);a(this,Ft);a(this,Rt);a(this,Z);a(this,Y,void 0);a(this,g,void 0);a(this,p,[]);a(this,mt,0);a(this,ct,void 0);if(f(this,Y,i),f(this,g,(n=(r=i.options)==null?void 0:r.chunkSize)!=null?n:Be),f(this,ct,s),!Number.isInteger(t(this,g))||t(this,g)<b(2,10))throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(i){o(this,bt,te).call(this,i,this.pos),o(this,Z,At).call(this),this.pos+=i.byteLength}finalize(){var i,s;o(this,Z,At).call(this,!0),(s=(i=t(this,Y)).onDone)==null||s.call(i)}};Y=new WeakMap,g=new WeakMap,p=new WeakMap,mt=new WeakMap,ct=new WeakMap,bt=new WeakSet,te=function(i,s){let r=t(this,p).findIndex(W=>W.start<=s&&s<W.start+t(this,g));r===-1&&(r=o(this,Rt,ye).call(this,s));let n=t(this,p)[r],d=s-n.start,c=i.subarray(0,Math.min(t(this,g)-d,i.byteLength));n.data.set(c,d);let it={start:d,end:d+c.byteLength};if(o(this,Ft,we).call(this,n,it),n.written[0].start===0&&n.written[0].end===t(this,g)&&(n.shouldFlush=!0),t(this,p).length>Ke){for(let W=0;W<t(this,p).length-1;W++)t(this,p)[W].shouldFlush=!0;o(this,Z,At).call(this)}c.byteLength<i.byteLength&&o(this,bt,te).call(this,i.subarray(c.byteLength),s+c.byteLength)},Ft=new WeakSet,we=function(i,s){let r=0,n=i.written.length-1,d=-1;for(;r<=n;){let c=Math.floor(r+(n-r+1)/2);i.written[c].start<=s.start?(r=c+1,d=c):n=c-1}for(i.written.splice(d+1,0,s),(d===-1||i.written[d].end<s.start)&&d++;d<i.written.length-1&&i.written[d].end>=i.written[d+1].start;)i.written[d].end=Math.max(i.written[d].end,i.written[d+1].end),i.written.splice(d+1,1)},Rt=new WeakSet,ye=function(i){let r={start:Math.floor(i/t(this,g))*t(this,g),data:new Uint8Array(t(this,g)),written:[],shouldFlush:!1};return t(this,p).push(r),t(this,p).sort((n,d)=>n.start-d.start),t(this,p).indexOf(r)},Z=new WeakSet,At=function(i=!1){for(let s=0;s<t(this,p).length;s++){let r=t(this,p)[s];if(!(!r.shouldFlush&&!i)){for(let n of r.written){if(t(this,ct)&&r.start+n.start<t(this,mt))throw new Error("Internal error: Monotonicity violation.");t(this,Y).onData(r.data.subarray(n.start,n.end),r.start+n.start),f(this,mt,r.start+n.end)}t(this,p).splice(s--,1)}}};var zt=class extends ht{constructor(e,i){var s;super(new E((r,n)=>e.stream.write({type:"write",data:r,position:n}),void 0,{chunkSize:(s=e.options)==null?void 0:s.chunkSize}),i)}};var F=1,_t=2,$e=1,Ye=2,ee=b(2,15),Mt=b(2,12),xe="https://github.com/Vanilagy/webm-muxer",ke=6,Ce=5,Ze=["strict","offset","permissive"],u,l,q,G,w,_,M,z,v,k,N,y,O,Q,C,T,j,L,J,I,tt,gt,Ot,Te,Ht,Se,Wt,Ae,Bt,Ue,Kt,ze,$t,Ve,Yt,De,wt,ie,yt,se,Zt,Pe,H,pt,V,X,Xt,Ee,qt,Fe,xt,re,Gt,Re,S,R,et,vt,kt,ae,Qt,_e,Ct,ne,Tt,he,Nt=class{constructor(e){a(this,Ot);a(this,Ht);a(this,Wt);a(this,Bt);a(this,Kt);a(this,$t);a(this,Yt);a(this,wt);a(this,yt);a(this,Zt);a(this,H);a(this,V);a(this,Xt);a(this,qt);a(this,xt);a(this,Gt);a(this,S);a(this,et);a(this,kt);a(this,Qt);a(this,Ct);a(this,Tt);a(this,u,void 0);a(this,l,void 0);a(this,q,void 0);a(this,G,void 0);a(this,w,void 0);a(this,_,void 0);a(this,M,void 0);a(this,z,void 0);a(this,v,void 0);a(this,k,void 0);a(this,N,void 0);a(this,y,void 0);a(this,O,void 0);a(this,Q,0);a(this,C,[]);a(this,T,[]);a(this,j,void 0);a(this,L,void 0);a(this,J,-1);a(this,I,-1);a(this,tt,void 0);a(this,gt,!1);var s;o(this,Ot,Te).call(this,e),f(this,u,ue({type:"webm",firstTimestampBehavior:"strict"},e)),this.target=e.target;let i=!!t(this,u).streaming;if(e.target instanceof st)f(this,l,new Ut(e.target));else if(e.target instanceof E)f(this,l,(s=e.target.options)!=null&&s.chunked?new ht(e.target,i):new nt(e.target,i));else if(e.target instanceof rt)f(this,l,new zt(e.target,i));else throw new Error(`Invalid target: ${e.target}`);o(this,Ht,Se).call(this)}addVideoChunk(e,i,s){let r=new Uint8Array(e.byteLength);e.copyTo(r),this.addVideoChunkRaw(r,e.type,s!=null?s:e.timestamp,i)}addVideoChunkRaw(e,i,s,r){if(o(this,Tt,he).call(this),!t(this,u).video)throw new Error("No video track declared.");t(this,j)===void 0&&f(this,j,s),r&&o(this,Xt,Ee).call(this,r);let n=o(this,xt,re).call(this,e,i,s,F);for(t(this,u).video.codec==="V_VP9"&&o(this,qt,Fe).call(this,n),f(this,J,n.timestamp);t(this,T).length>0&&t(this,T)[0].timestamp<=n.timestamp;){let d=t(this,T).shift();o(this,S,R).call(this,d)}!t(this,u).audio||n.timestamp<=t(this,I)?o(this,S,R).call(this,n):t(this,C).push(n),o(this,H,pt).call(this)}addAudioChunk(e,i,s){let r=new Uint8Array(e.byteLength);e.copyTo(r),this.addAudioChunkRaw(r,e.type,s!=null?s:e.timestamp,i)}addAudioChunkRaw(e,i,s,r){if(o(this,Tt,he).call(this),!t(this,u).audio)throw new Error("No audio track declared.");t(this,L)===void 0&&f(this,L,s),r!=null&&r.decoderConfig&&(t(this,u).streaming?f(this,k,o(this,et,vt).call(this,r.decoderConfig.description)):o(this,kt,ae).call(this,t(this,k),r.decoderConfig.description));let n=o(this,xt,re).call(this,e,i,s,_t);for(f(this,I,n.timestamp);t(this,C).length>0&&t(this,C)[0].timestamp<=n.timestamp;){let d=t(this,C).shift();o(this,S,R).call(this,d)}!t(this,u).video||n.timestamp<=t(this,J)?o(this,S,R).call(this,n):t(this,T).push(n),o(this,H,pt).call(this)}finalize(){for(;t(this,C).length>0;)o(this,S,R).call(this,t(this,C).shift());for(;t(this,T).length>0;)o(this,S,R).call(this,t(this,T).shift());if(t(this,u).streaming||o(this,Ct,ne).call(this),t(this,l).writeEBML(t(this,N)),!t(this,u).streaming){let e=t(this,l).pos,i=t(this,l).pos-t(this,V,X);t(this,l).seek(t(this,l).offsets.get(t(this,q))+4),t(this,l).writeEBMLVarInt(i,ke),t(this,M).data=new D(t(this,Q)),t(this,l).seek(t(this,l).offsets.get(t(this,M))),t(this,l).writeEBML(t(this,M)),t(this,w).data[0].data[1].data=t(this,l).offsets.get(t(this,N))-t(this,V,X),t(this,w).data[1].data[1].data=t(this,l).offsets.get(t(this,G))-t(this,V,X),t(this,w).data[2].data[1].data=t(this,l).offsets.get(t(this,_))-t(this,V,X),t(this,l).seek(t(this,l).offsets.get(t(this,w))),t(this,l).writeEBML(t(this,w)),t(this,l).seek(e)}o(this,H,pt).call(this),t(this,l).finalize(),f(this,gt,!0)}};u=new WeakMap,l=new WeakMap,q=new WeakMap,G=new WeakMap,w=new WeakMap,_=new WeakMap,M=new WeakMap,z=new WeakMap,v=new WeakMap,k=new WeakMap,N=new WeakMap,y=new WeakMap,O=new WeakMap,Q=new WeakMap,C=new WeakMap,T=new WeakMap,j=new WeakMap,L=new WeakMap,J=new WeakMap,I=new WeakMap,tt=new WeakMap,gt=new WeakMap,Ot=new WeakSet,Te=function(e){if(e.type&&e.type!=="webm"&&e.type!=="matroska")throw new Error(`Invalid type: ${e.type}`);if(e.firstTimestampBehavior&&!Ze.includes(e.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`)},Ht=new WeakSet,Se=function(){o(this,Wt,Ae).call(this),t(this,u).streaming||o(this,$t,Ve).call(this),o(this,Yt,De).call(this),o(this,Bt,Ue).call(this),o(this,Kt,ze).call(this),t(this,u).streaming||(o(this,wt,ie).call(this),o(this,yt,se).call(this)),o(this,Zt,Pe).call(this),o(this,H,pt).call(this)},Wt=new WeakSet,Ae=function(){var i;let e={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:(i=t(this,u).type)!=null?i:"webm"},{id:17031,data:2},{id:17029,data:2}]};t(this,l).writeEBML(e)},Bt=new WeakSet,Ue=function(){f(this,v,{id:236,size:4,data:new Uint8Array(Mt)}),f(this,k,{id:236,size:4,data:new Uint8Array(Mt)})},Kt=new WeakSet,ze=function(){f(this,z,{id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]})},$t=new WeakSet,Ve=function(){let e=new Uint8Array([28,83,187,107]),i=new Uint8Array([21,73,169,102]),s=new Uint8Array([22,84,174,107]),r={id:290298740,data:[{id:19899,data:[{id:21419,data:e},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:i},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:s},{id:21420,size:5,data:0}]}]};f(this,w,r)},Yt=new WeakSet,De=function(){let e={id:17545,data:new D(0)};f(this,M,e);let i={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:xe},{id:22337,data:xe},t(this,u).streaming?null:e]};f(this,G,i)},wt=new WeakSet,ie=function(){let e={id:374648427,data:[]};f(this,_,e),t(this,u).video&&e.data.push({id:174,data:[{id:215,data:F},{id:29637,data:F},{id:131,data:$e},{id:134,data:t(this,u).video.codec},t(this,v),t(this,u).video.frameRate?{id:2352003,data:1e9/t(this,u).video.frameRate}:null,{id:224,data:[{id:176,data:t(this,u).video.width},{id:186,data:t(this,u).video.height},t(this,u).video.alpha?{id:21440,data:1}:null,t(this,z)]}]}),t(this,u).audio&&(f(this,k,t(this,u).streaming?t(this,k)||null:{id:236,size:4,data:new Uint8Array(Mt)}),e.data.push({id:174,data:[{id:215,data:_t},{id:29637,data:_t},{id:131,data:Ye},{id:134,data:t(this,u).audio.codec},t(this,k),{id:225,data:[{id:181,data:new B(t(this,u).audio.sampleRate)},{id:159,data:t(this,u).audio.numberOfChannels},t(this,u).audio.bitDepth?{id:25188,data:t(this,u).audio.bitDepth}:null]}]}))},yt=new WeakSet,se=function(){let e={id:408125543,size:t(this,u).streaming?-1:ke,data:[t(this,u).streaming?null:t(this,w),t(this,G),t(this,_)]};f(this,q,e),t(this,l).writeEBML(e)},Zt=new WeakSet,Pe=function(){f(this,N,{id:475249515,data:[]})},H=new WeakSet,pt=function(){t(this,l)instanceof nt&&t(this,l).flush()},V=new WeakSet,X=function(){return t(this,l).dataOffsets.get(t(this,q))},Xt=new WeakSet,Ee=function(e){if(!!e.decoderConfig){if(e.decoderConfig.colorSpace){let i=e.decoderConfig.colorSpace;if(f(this,tt,i),t(this,z).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[i.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[i.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[i.primaries]},{id:21945,data:[1,2][Number(i.fullRange)]}],!t(this,u).streaming){let s=t(this,l).pos;t(this,l).seek(t(this,l).offsets.get(t(this,z))),t(this,l).writeEBML(t(this,z)),t(this,l).seek(s)}}e.decoderConfig.description&&(t(this,u).streaming?f(this,v,o(this,et,vt).call(this,e.decoderConfig.description)):o(this,kt,ae).call(this,t(this,v),e.decoderConfig.description))}},qt=new WeakSet,Fe=function(e){if(e.type!=="key"||!t(this,tt))return;let i=0;if(P(e.data,0,2)!==2)return;i+=2;let s=(P(e.data,i+1,i+2)<<1)+P(e.data,i+0,i+1);i+=2,s===3&&i++;let r=P(e.data,i+0,i+1);if(i++,r)return;let n=P(e.data,i+0,i+1);if(i++,n!==0)return;i+=2;let d=P(e.data,i+0,i+24);if(i+=24,d!==4817730)return;s>=2&&i++;let c={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[t(this,tt).matrix];me(e.data,i+0,i+3,c)},xt=new WeakSet,re=function(e,i,s,r){let n=o(this,Gt,Re).call(this,s,r);return{data:e,type:i,timestamp:n,trackNumber:r}},Gt=new WeakSet,Re=function(e,i){let s=i===F?t(this,j):t(this,L),r=i===F?t(this,J):t(this,I);if(t(this,u).firstTimestampBehavior==="strict"&&r===-1&&e!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${e}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
If you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.
`);if(t(this,u).firstTimestampBehavior==="offset"&&(e-=s),e<r)throw new Error(`Timestamps must be monotonically increasing (went from ${r} to ${e}).`);return e},S=new WeakSet,R=function(e){t(this,u).streaming&&!t(this,_)&&(o(this,wt,ie).call(this),o(this,yt,se).call(this));let i=Math.floor(e.timestamp/1e3);if(e.type!=="key"&&i-t(this,O)>=ee)throw new Error(`Current Matroska cluster exceeded its maximum allowed length of ${ee} milliseconds. In order to produce a correct WebM file, you must pass in a video key frame at least every ${ee} milliseconds.`);let r=(e.trackNumber===F||!t(this,u).video)&&e.type==="key"&&i-t(this,O)>=1e3;(!t(this,y)||r)&&o(this,Qt,_e).call(this,i);let n=new Uint8Array(4),d=new DataView(n.buffer);d.setUint8(0,128|e.trackNumber),d.setUint16(1,i-t(this,O),!1),d.setUint8(3,Number(e.type==="key")<<7);let c={id:163,data:[n,e.data]};t(this,l).writeEBML(c),f(this,Q,Math.max(t(this,Q),i))},et=new WeakSet,vt=function(e){return{id:25506,size:4,data:new Uint8Array(e)}},kt=new WeakSet,ae=function(e,i){let s=t(this,l).pos;t(this,l).seek(t(this,l).offsets.get(e)),e=[o(this,et,vt).call(this,i),{id:236,size:4,data:new Uint8Array(Mt-2-4-i.byteLength)}],t(this,l).writeEBML(e),t(this,l).seek(s)},Qt=new WeakSet,_e=function(e){t(this,y)&&!t(this,u).streaming&&o(this,Ct,ne).call(this),f(this,y,{id:524531317,size:t(this,u).streaming?-1:Ce,data:[{id:231,data:e}]}),t(this,l).writeEBML(t(this,y)),f(this,O,e);let i=t(this,l).offsets.get(t(this,y))-t(this,V,X);t(this,N).data.push({id:187,data:[{id:179,data:e},t(this,u).video?{id:183,data:[{id:247,data:F},{id:241,data:i}]}:null,t(this,u).audio?{id:183,data:[{id:247,data:_t},{id:241,data:i}]}:null]})},Ct=new WeakSet,ne=function(){let e=t(this,l).pos-t(this,l).dataOffsets.get(t(this,y)),i=t(this,l).pos;t(this,l).seek(t(this,l).offsets.get(t(this,y))+4),t(this,l).writeEBMLVarInt(e,Ce),t(this,l).seek(i)},Tt=new WeakSet,he=function(){if(t(this,gt))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};return We(Xe);})();
if (typeof module === "object" && typeof module.exports === "object") Object.assign(module.exports, WebMMuxer)
