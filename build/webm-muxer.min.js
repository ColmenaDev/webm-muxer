"use strict";var WebMMuxer=(()=>{var At=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames,oe=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var b=Math.pow,le=(h,t,i)=>t in h?At(h,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[t]=i,fe=(h,t)=>{for(var i in t||={})de.call(t,i)&&le(h,i,t[i]);if(oe)for(var i of oe(t))Ne.call(t,i)&&le(h,i,t[i]);return h};var Oe=(h,t)=>{for(var i in t)At(h,i,{get:t[i],enumerable:!0})},He=(h,t,i,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ve(t))!de.call(h,r)&&r!==i&&At(h,r,{get:()=>t[r],enumerable:!(s=_e(t,r))||s.enumerable});return h};var We=h=>He(At({},"__esModule",{value:!0}),h);var jt=(h,t,i)=>{if(!t.has(h))throw TypeError("Cannot "+i)};var e=(h,t,i)=>(jt(h,t,"read from private field"),i?i.call(h):t.get(h)),a=(h,t,i)=>{if(t.has(h))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(h):t.set(h,i)},u=(h,t,i,s)=>(jt(h,t,"write to private field"),s?s.call(h,i):t.set(h,i),i);var o=(h,t,i)=>(jt(h,t,"access private method"),i);var Ze={};Oe(Ze,{ArrayBufferTarget:()=>st,FileSystemWritableFileStreamTarget:()=>rt,Muxer:()=>Nt,StreamTarget:()=>P});var W=class{constructor(t){this.value=t}},V=class{constructor(t){this.value=t}};var Jt=h=>h<1<<8?1:h<1<<16?2:h<1<<24?3:h<b(2,32)?4:h<b(2,40)?5:6,ue=h=>{if(h<(1<<7)-1)return 1;if(h<(1<<14)-1)return 2;if(h<(1<<21)-1)return 3;if(h<(1<<28)-1)return 4;if(h<b(2,35)-1)return 5;if(h<b(2,42)-1)return 6;throw new Error("EBML VINT size not supported "+h)};var D=(h,t,i)=>{let s=0;for(let r=t;r<i;r++){let n=Math.floor(r/8),d=h[n],c=7-(r&7),it=(d&1<<c)>>c;s<<=1,s|=it}return s},me=(h,t,i,s)=>{for(let r=t;r<i;r++){let n=Math.floor(r/8),d=h[n],c=7-(r&7);d&=~(1<<c),d|=(s&1<<i-r-1)>>i-r-1<<c,h[n]=d}};var st=class{constructor(){this.buffer=null}},P=class{constructor(t,i,s){this.onData=t;this.onDone=i;this.options=s}},rt=class{constructor(t){this.stream=t}};var y,m,Vt,ce,Dt,be,Pt,pe,ot,Lt,Et,ge,at=class{constructor(){a(this,Vt);a(this,Dt);a(this,Pt);a(this,ot);a(this,Et);this.pos=0;a(this,y,new Uint8Array(8));a(this,m,new DataView(e(this,y).buffer));this.offsets=new WeakMap;this.dataOffsets=new WeakMap}seek(t){this.pos=t}writeEBMLVarInt(t,i=ue(t)){let s=0;switch(i){case 1:e(this,m).setUint8(s++,1<<7|t);break;case 2:e(this,m).setUint8(s++,1<<6|t>>8),e(this,m).setUint8(s++,t);break;case 3:e(this,m).setUint8(s++,1<<5|t>>16),e(this,m).setUint8(s++,t>>8),e(this,m).setUint8(s++,t);break;case 4:e(this,m).setUint8(s++,1<<4|t>>24),e(this,m).setUint8(s++,t>>16),e(this,m).setUint8(s++,t>>8),e(this,m).setUint8(s++,t);break;case 5:e(this,m).setUint8(s++,1<<3|t/b(2,32)&7),e(this,m).setUint8(s++,t>>24),e(this,m).setUint8(s++,t>>16),e(this,m).setUint8(s++,t>>8),e(this,m).setUint8(s++,t);break;case 6:e(this,m).setUint8(s++,1<<2|t/b(2,40)&3),e(this,m).setUint8(s++,t/b(2,32)|0),e(this,m).setUint8(s++,t>>24),e(this,m).setUint8(s++,t>>16),e(this,m).setUint8(s++,t>>8),e(this,m).setUint8(s++,t);break;default:throw new Error("Bad EBML VINT size "+i)}this.write(e(this,y).subarray(0,s))}writeEBML(t){var i,s;if(t!==null)if(t instanceof Uint8Array)this.write(t);else if(Array.isArray(t))for(let r of t)this.writeEBML(r);else if(this.offsets.set(t,this.pos),o(this,ot,Lt).call(this,t.id),Array.isArray(t.data)){let r=this.pos,n=t.size===-1?1:(i=t.size)!=null?i:4;t.size===-1?o(this,Vt,ce).call(this,255):this.seek(this.pos+n);let d=this.pos;if(this.dataOffsets.set(t,d),this.writeEBML(t.data),t.size!==-1){let c=this.pos-d,it=this.pos;this.seek(r),this.writeEBMLVarInt(c,n),this.seek(it)}}else if(typeof t.data=="number"){let r=(s=t.size)!=null?s:Jt(t.data);this.writeEBMLVarInt(r),o(this,ot,Lt).call(this,t.data,r)}else typeof t.data=="string"?(this.writeEBMLVarInt(t.data.length),o(this,Et,ge).call(this,t.data)):t.data instanceof Uint8Array?(this.writeEBMLVarInt(t.data.byteLength,t.size),this.write(t.data)):t.data instanceof W?(this.writeEBMLVarInt(4),o(this,Dt,be).call(this,t.data.value)):t.data instanceof V&&(this.writeEBMLVarInt(8),o(this,Pt,pe).call(this,t.data.value))}};y=new WeakMap,m=new WeakMap,Vt=new WeakSet,ce=function(t){e(this,m).setUint8(0,t),this.write(e(this,y).subarray(0,1))},Dt=new WeakSet,be=function(t){e(this,m).setFloat32(0,t,!1),this.write(e(this,y).subarray(0,4))},Pt=new WeakSet,pe=function(t){e(this,m).setFloat64(0,t,!1),this.write(e(this,y))},ot=new WeakSet,Lt=function(t,i=Jt(t)){let s=0;switch(i){case 6:e(this,m).setUint8(s++,t/b(2,40)|0);case 5:e(this,m).setUint8(s++,t/b(2,32)|0);case 4:e(this,m).setUint8(s++,t>>24);case 3:e(this,m).setUint8(s++,t>>16);case 2:e(this,m).setUint8(s++,t>>8);case 1:e(this,m).setUint8(s++,t);break;default:throw new Error("Bad UINT size "+i)}this.write(e(this,y).subarray(0,s))},Et=new WeakSet,ge=function(t){this.write(new Uint8Array(t.split("").map(i=>i.charCodeAt(0))))};var lt,A,K,dt,It,Ut=class extends at{constructor(i){super();a(this,dt);a(this,lt,void 0);a(this,A,new ArrayBuffer(b(2,16)));a(this,K,new Uint8Array(e(this,A)));u(this,lt,i)}write(i){o(this,dt,It).call(this,this.pos+i.byteLength),e(this,K).set(i,this.pos),this.pos+=i.byteLength}finalize(){o(this,dt,It).call(this,this.pos),e(this,lt).buffer=e(this,A).slice(0,this.pos)}};lt=new WeakMap,A=new WeakMap,K=new WeakMap,dt=new WeakSet,It=function(i){let s=e(this,A).byteLength;for(;s<i;)s*=2;if(s===e(this,A).byteLength)return;let r=new ArrayBuffer(s),n=new Uint8Array(r);n.set(e(this,K),0),u(this,A,r),u(this,K,n)};var $,S,ft,ut,nt=class extends at{constructor(i,s){super();a(this,$,void 0);a(this,S,[]);a(this,ft,0);a(this,ut,void 0);u(this,$,i),u(this,ut,s)}write(i){e(this,S).push({data:i.slice(),start:this.pos}),this.pos+=i.byteLength}flush(){if(e(this,S).length===0)return;let i=[],s=[...e(this,S)].sort((r,n)=>r.start-n.start);i.push({start:s[0].start,size:s[0].data.byteLength});for(let r=1;r<s.length;r++){let n=i[i.length-1],d=s[r];d.start<=n.start+n.size?n.size=Math.max(n.size,d.start+d.data.byteLength-n.start):i.push({start:d.start,size:d.data.byteLength})}for(let r of i){r.data=new Uint8Array(r.size);for(let n of e(this,S))r.start<=n.start&&n.start<r.start+r.size&&r.data.set(n.data,n.start-r.start);if(e(this,ut)&&r.start<e(this,ft))throw new Error("Internal error: Monotonicity violation.");e(this,$).onData(r.data,r.start),u(this,ft,r.start+r.data.byteLength)}e(this,S).length=0}finalize(){var i,s;(s=(i=e(this,$)).onDone)==null||s.call(i)}};$=new WeakMap,S=new WeakMap,ft=new WeakMap,ut=new WeakMap;var B=b(2,24),Be=2,Y,p,mt,ct,bt,te,Ft,we,Rt,ye,Z,St,ht=class extends at{constructor(i,s){super();a(this,bt);a(this,Ft);a(this,Rt);a(this,Z);a(this,Y,void 0);a(this,p,[]);a(this,mt,0);a(this,ct,void 0);u(this,Y,i),u(this,ct,s)}write(i){o(this,bt,te).call(this,i,this.pos),o(this,Z,St).call(this),this.pos+=i.byteLength}finalize(){var i,s;o(this,Z,St).call(this,!0),(s=(i=e(this,Y)).onDone)==null||s.call(i)}};Y=new WeakMap,p=new WeakMap,mt=new WeakMap,ct=new WeakMap,bt=new WeakSet,te=function(i,s){let r=e(this,p).findIndex(H=>H.start<=s&&s<H.start+B);r===-1&&(r=o(this,Rt,ye).call(this,s));let n=e(this,p)[r],d=s-n.start,c=i.subarray(0,Math.min(B-d,i.byteLength));n.data.set(c,d);let it={start:d,end:d+c.byteLength};if(o(this,Ft,we).call(this,n,it),n.written[0].start===0&&n.written[0].end===B&&(n.shouldFlush=!0),e(this,p).length>Be){for(let H=0;H<e(this,p).length-1;H++)e(this,p)[H].shouldFlush=!0;o(this,Z,St).call(this)}c.byteLength<i.byteLength&&o(this,bt,te).call(this,i.subarray(c.byteLength),s+c.byteLength)},Ft=new WeakSet,we=function(i,s){let r=0,n=i.written.length-1,d=-1;for(;r<=n;){let c=Math.floor(r+(n-r+1)/2);i.written[c].start<=s.start?(r=c+1,d=c):n=c-1}for(i.written.splice(d+1,0,s),(d===-1||i.written[d].end<s.start)&&d++;d<i.written.length-1&&i.written[d].end>=i.written[d+1].start;)i.written[d].end=Math.max(i.written[d].end,i.written[d+1].end),i.written.splice(d+1,1)},Rt=new WeakSet,ye=function(i){let r={start:Math.floor(i/B)*B,data:new Uint8Array(B),written:[],shouldFlush:!1};return e(this,p).push(r),e(this,p).sort((n,d)=>n.start-d.start),e(this,p).indexOf(r)},Z=new WeakSet,St=function(i=!1){for(let s=0;s<e(this,p).length;s++){let r=e(this,p)[s];if(!(!r.shouldFlush&&!i)){for(let n of r.written){if(e(this,ct)&&r.start+n.start<e(this,mt))throw new Error("Internal error: Monotonicity violation.");e(this,Y).onData(r.data.subarray(n.start,n.end),r.start+n.start),u(this,mt,r.start+n.end)}e(this,p).splice(s--,1)}}};var zt=class extends ht{constructor(t,i){super(new P((s,r)=>t.stream.write({type:"write",data:s,position:r})),i)}};var E=1,Mt=2,Ke=1,$e=2,ee=b(2,15),_t=b(2,12),xe="https://github.com/Vanilagy/webm-muxer",Ce=6,Te=5,Ye=["strict","offset","permissive"],f,l,q,G,g,R,M,U,_,x,v,w,N,Q,C,T,j,J,L,I,tt,gt,Ot,ke,Ht,Ae,Wt,Se,Bt,Ue,Kt,ze,$t,Ve,Yt,De,wt,ie,yt,se,Zt,Pe,O,pt,z,X,Xt,Ee,qt,Fe,xt,re,Gt,Re,k,F,et,vt,Ct,ae,Qt,Me,Tt,ne,kt,he,Nt=class{constructor(t){a(this,Ot);a(this,Ht);a(this,Wt);a(this,Bt);a(this,Kt);a(this,$t);a(this,Yt);a(this,wt);a(this,yt);a(this,Zt);a(this,O);a(this,z);a(this,Xt);a(this,qt);a(this,xt);a(this,Gt);a(this,k);a(this,et);a(this,Ct);a(this,Qt);a(this,Tt);a(this,kt);a(this,f,void 0);a(this,l,void 0);a(this,q,void 0);a(this,G,void 0);a(this,g,void 0);a(this,R,void 0);a(this,M,void 0);a(this,U,void 0);a(this,_,void 0);a(this,x,void 0);a(this,v,void 0);a(this,w,void 0);a(this,N,void 0);a(this,Q,0);a(this,C,[]);a(this,T,[]);a(this,j,void 0);a(this,J,void 0);a(this,L,-1);a(this,I,-1);a(this,tt,void 0);a(this,gt,!1);var s;o(this,Ot,ke).call(this,t),u(this,f,fe({type:"webm",firstTimestampBehavior:"strict"},t)),this.target=t.target;let i=!!e(this,f).streaming;if(t.target instanceof st)u(this,l,new Ut(t.target));else if(t.target instanceof P)u(this,l,(s=t.target.options)!=null&&s.chunked?new ht(t.target,i):new nt(t.target,i));else if(t.target instanceof rt)u(this,l,new zt(t.target,i));else throw new Error(`Invalid target: ${t.target}`);o(this,Ht,Ae).call(this)}addVideoChunk(t,i,s){let r=new Uint8Array(t.byteLength);t.copyTo(r),this.addVideoChunkRaw(r,t.type,s!=null?s:t.timestamp,i)}addVideoChunkRaw(t,i,s,r){if(o(this,kt,he).call(this),!e(this,f).video)throw new Error("No video track declared.");e(this,j)===void 0&&u(this,j,s),r&&o(this,Xt,Ee).call(this,r);let n=o(this,xt,re).call(this,t,i,s,E);for(e(this,f).video.codec==="V_VP9"&&o(this,qt,Fe).call(this,n),u(this,L,n.timestamp);e(this,T).length>0&&e(this,T)[0].timestamp<=n.timestamp;){let d=e(this,T).shift();o(this,k,F).call(this,d)}!e(this,f).audio||n.timestamp<=e(this,I)?o(this,k,F).call(this,n):e(this,C).push(n),o(this,O,pt).call(this)}addAudioChunk(t,i,s){let r=new Uint8Array(t.byteLength);t.copyTo(r),this.addAudioChunkRaw(r,t.type,s!=null?s:t.timestamp,i)}addAudioChunkRaw(t,i,s,r){if(o(this,kt,he).call(this),!e(this,f).audio)throw new Error("No audio track declared.");e(this,J)===void 0&&u(this,J,s),r!=null&&r.decoderConfig&&(e(this,f).streaming?u(this,x,o(this,et,vt).call(this,r.decoderConfig.description)):o(this,Ct,ae).call(this,e(this,x),r.decoderConfig.description));let n=o(this,xt,re).call(this,t,i,s,Mt);for(u(this,I,n.timestamp);e(this,C).length>0&&e(this,C)[0].timestamp<=n.timestamp;){let d=e(this,C).shift();o(this,k,F).call(this,d)}!e(this,f).video||n.timestamp<=e(this,L)?o(this,k,F).call(this,n):e(this,T).push(n),o(this,O,pt).call(this)}finalize(){for(;e(this,C).length>0;)o(this,k,F).call(this,e(this,C).shift());for(;e(this,T).length>0;)o(this,k,F).call(this,e(this,T).shift());if(e(this,f).streaming||o(this,Tt,ne).call(this),e(this,l).writeEBML(e(this,v)),!e(this,f).streaming){let t=e(this,l).pos,i=e(this,l).pos-e(this,z,X);e(this,l).seek(e(this,l).offsets.get(e(this,q))+4),e(this,l).writeEBMLVarInt(i,Ce),e(this,M).data=new V(e(this,Q)),e(this,l).seek(e(this,l).offsets.get(e(this,M))),e(this,l).writeEBML(e(this,M)),e(this,g).data[0].data[1].data=e(this,l).offsets.get(e(this,v))-e(this,z,X),e(this,g).data[1].data[1].data=e(this,l).offsets.get(e(this,G))-e(this,z,X),e(this,g).data[2].data[1].data=e(this,l).offsets.get(e(this,R))-e(this,z,X),e(this,l).seek(e(this,l).offsets.get(e(this,g))),e(this,l).writeEBML(e(this,g)),e(this,l).seek(t)}o(this,O,pt).call(this),e(this,l).finalize(),u(this,gt,!0)}};f=new WeakMap,l=new WeakMap,q=new WeakMap,G=new WeakMap,g=new WeakMap,R=new WeakMap,M=new WeakMap,U=new WeakMap,_=new WeakMap,x=new WeakMap,v=new WeakMap,w=new WeakMap,N=new WeakMap,Q=new WeakMap,C=new WeakMap,T=new WeakMap,j=new WeakMap,J=new WeakMap,L=new WeakMap,I=new WeakMap,tt=new WeakMap,gt=new WeakMap,Ot=new WeakSet,ke=function(t){if(t.type&&t.type!=="webm"&&t.type!=="matroska")throw new Error(`Invalid type: ${t.type}`);if(t.firstTimestampBehavior&&!Ye.includes(t.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`)},Ht=new WeakSet,Ae=function(){o(this,Wt,Se).call(this),e(this,f).streaming||o(this,$t,Ve).call(this),o(this,Yt,De).call(this),o(this,Bt,Ue).call(this),o(this,Kt,ze).call(this),e(this,f).streaming||(o(this,wt,ie).call(this),o(this,yt,se).call(this)),o(this,Zt,Pe).call(this),o(this,O,pt).call(this)},Wt=new WeakSet,Se=function(){var i;let t={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:(i=e(this,f).type)!=null?i:"webm"},{id:17031,data:2},{id:17029,data:2}]};e(this,l).writeEBML(t)},Bt=new WeakSet,Ue=function(){u(this,_,{id:236,size:4,data:new Uint8Array(_t)}),u(this,x,{id:236,size:4,data:new Uint8Array(_t)})},Kt=new WeakSet,ze=function(){u(this,U,{id:21936,data:[{id:21937,data:2},{id:21946,data:2},{id:21947,data:2},{id:21945,data:0}]})},$t=new WeakSet,Ve=function(){let t=new Uint8Array([28,83,187,107]),i=new Uint8Array([21,73,169,102]),s=new Uint8Array([22,84,174,107]),r={id:290298740,data:[{id:19899,data:[{id:21419,data:t},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:i},{id:21420,size:5,data:0}]},{id:19899,data:[{id:21419,data:s},{id:21420,size:5,data:0}]}]};u(this,g,r)},Yt=new WeakSet,De=function(){let t={id:17545,data:new V(0)};u(this,M,t);let i={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:xe},{id:22337,data:xe},e(this,f).streaming?null:t]};u(this,G,i)},wt=new WeakSet,ie=function(){let t={id:374648427,data:[]};u(this,R,t),e(this,f).video&&t.data.push({id:174,data:[{id:215,data:E},{id:29637,data:E},{id:131,data:Ke},{id:134,data:e(this,f).video.codec},e(this,_),e(this,f).video.frameRate?{id:2352003,data:1e9/e(this,f).video.frameRate}:null,{id:224,data:[{id:176,data:e(this,f).video.width},{id:186,data:e(this,f).video.height},e(this,f).video.alpha?{id:21440,data:1}:null,e(this,U)]}]}),e(this,f).audio&&(u(this,x,e(this,f).streaming?e(this,x)||null:{id:236,size:4,data:new Uint8Array(_t)}),t.data.push({id:174,data:[{id:215,data:Mt},{id:29637,data:Mt},{id:131,data:$e},{id:134,data:e(this,f).audio.codec},e(this,x),{id:225,data:[{id:181,data:new W(e(this,f).audio.sampleRate)},{id:159,data:e(this,f).audio.numberOfChannels},e(this,f).audio.bitDepth?{id:25188,data:e(this,f).audio.bitDepth}:null]}]}))},yt=new WeakSet,se=function(){let t={id:408125543,size:e(this,f).streaming?-1:Ce,data:[e(this,f).streaming?null:e(this,g),e(this,G),e(this,R)]};u(this,q,t),e(this,l).writeEBML(t)},Zt=new WeakSet,Pe=function(){u(this,v,{id:475249515,data:[]})},O=new WeakSet,pt=function(){e(this,l)instanceof nt&&e(this,l).flush()},z=new WeakSet,X=function(){return e(this,l).dataOffsets.get(e(this,q))},Xt=new WeakSet,Ee=function(t){if(!!t.decoderConfig){if(t.decoderConfig.colorSpace){let i=t.decoderConfig.colorSpace;if(u(this,tt,i),e(this,U).data=[{id:21937,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[i.matrix]},{id:21946,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[i.transfer]},{id:21947,data:{bt709:1,bt470bg:5,smpte170m:6}[i.primaries]},{id:21945,data:[1,2][Number(i.fullRange)]}],!e(this,f).streaming){let s=e(this,l).pos;e(this,l).seek(e(this,l).offsets.get(e(this,U))),e(this,l).writeEBML(e(this,U)),e(this,l).seek(s)}}t.decoderConfig.description&&(e(this,f).streaming?u(this,_,o(this,et,vt).call(this,t.decoderConfig.description)):o(this,Ct,ae).call(this,e(this,_),t.decoderConfig.description))}},qt=new WeakSet,Fe=function(t){if(t.type!=="key"||!e(this,tt))return;let i=0;if(D(t.data,0,2)!==2)return;i+=2;let s=(D(t.data,i+1,i+2)<<1)+D(t.data,i+0,i+1);i+=2,s===3&&i++;let r=D(t.data,i+0,i+1);if(i++,r)return;let n=D(t.data,i+0,i+1);if(i++,n!==0)return;i+=2;let d=D(t.data,i+0,i+24);if(i+=24,d!==4817730)return;s>=2&&i++;let c={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e(this,tt).matrix];me(t.data,i+0,i+3,c)},xt=new WeakSet,re=function(t,i,s,r){let n=o(this,Gt,Re).call(this,s,r);return{data:t,type:i,timestamp:n,trackNumber:r}},Gt=new WeakSet,Re=function(t,i){let s=i===E?e(this,j):e(this,J),r=i===E?e(this,L):e(this,I);if(e(this,f).firstTimestampBehavior==="strict"&&r===-1&&t!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${t}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
If you want to allow non-zero first timestamps, set firstTimestampBehavior: 'permissive'.
`);if(e(this,f).firstTimestampBehavior==="offset"&&(t-=s),t<r)throw new Error(`Timestamps must be monotonically increasing (went from ${r} to ${t}).`);return t},k=new WeakSet,F=function(t){e(this,f).streaming&&!e(this,R)&&(o(this,wt,ie).call(this),o(this,yt,se).call(this));let i=Math.floor(t.timestamp/1e3);if(t.type!=="key"&&i-e(this,N)>=ee)throw new Error(`Current Matroska cluster exceeded its maximum allowed length of ${ee} milliseconds. In order to produce a correct WebM file, you must pass in a video key frame at least every ${ee} milliseconds.`);let r=(t.trackNumber===E||!e(this,f).video)&&t.type==="key"&&i-e(this,N)>=1e3;(!e(this,w)||r)&&o(this,Qt,Me).call(this,i);let n=new Uint8Array(4),d=new DataView(n.buffer);d.setUint8(0,128|t.trackNumber),d.setUint16(1,i-e(this,N),!1),d.setUint8(3,Number(t.type==="key")<<7);let c={id:163,data:[n,t.data]};e(this,l).writeEBML(c),u(this,Q,Math.max(e(this,Q),i))},et=new WeakSet,vt=function(t){return{id:25506,size:4,data:new Uint8Array(t)}},Ct=new WeakSet,ae=function(t,i){let s=e(this,l).pos;e(this,l).seek(e(this,l).offsets.get(t)),t=[o(this,et,vt).call(this,i),{id:236,size:4,data:new Uint8Array(_t-2-4-i.byteLength)}],e(this,l).writeEBML(t),e(this,l).seek(s)},Qt=new WeakSet,Me=function(t){e(this,w)&&!e(this,f).streaming&&o(this,Tt,ne).call(this),u(this,w,{id:524531317,size:e(this,f).streaming?-1:Te,data:[{id:231,data:t}]}),e(this,l).writeEBML(e(this,w)),u(this,N,t);let i=e(this,l).offsets.get(e(this,w))-e(this,z,X);e(this,v).data.push({id:187,data:[{id:179,data:t},e(this,f).video?{id:183,data:[{id:247,data:E},{id:241,data:i}]}:null,e(this,f).audio?{id:183,data:[{id:247,data:Mt},{id:241,data:i}]}:null]})},Tt=new WeakSet,ne=function(){let t=e(this,l).pos-e(this,l).dataOffsets.get(e(this,w)),i=e(this,l).pos;e(this,l).seek(e(this,l).offsets.get(e(this,w))+4),e(this,l).writeEBMLVarInt(t,Te),e(this,l).seek(i)},kt=new WeakSet,he=function(){if(e(this,gt))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};return We(Ze);})();
if (typeof module === "object" && typeof module.exports === "object") {
	module.exports.Muxer = WebMMuxer.Muxer;
	module.exports.ArrayBufferTarget = WebMMuxer.ArrayBufferTarget;
	module.exports.StreamTarget = WebMMuxer.StreamTarget;
	module.exports.FileSystemWritableFileStreamTarget = WebMMuxer.FileSystemWritableFileStreamTarget;
}
